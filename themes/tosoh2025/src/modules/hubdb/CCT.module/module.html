{% set title = module.title || 'Competitor Comparison Tool (CCT)' %}
{% set description = module.description || 'Your centralized hub for technical assistance, product resources, and expert guidance across Tosoh Comparison Tool.' %}
{% set tosoh_instrument_name = request.query_dict.tosoh_instrument_name  or "" %}
{% set competitor_instrument_name = request.query_dict.competitor_instrument_name  or "" %}

{% set all_instruments = hubdb_table_rows("cct_instruments") %}
{% set all_comparisons = hubdb_table_rows("cct_comparison") %}

{% set tosoh_instrument = all_instruments|selectattr('product_name', 'equalto', tosoh_instrument_name)|first %}
{% set competitor_instrument = all_instruments|selectattr('product_name', 'equalto', competitor_instrument_name)|first %}

{% set roles = [['Laboratory Manager', 'laboratory_manager_benefits'], ['Laboratory Staff', 'laboratory_staff_benefits'], ['Clinician', 'clinician_benefits'], ['Procurement Manager', 'procurement_manager_benefits']] %}

{% require_js position="head" %}
  <script>
  const allInstruments = {{ all_instruments|tojson }};
  const allComparisons = {{ all_comparisons|tojson }};

  window.Tosoh.CCT = { allInstruments, allComparisons};
  </script>
{% end_require_js %}


<div class="gap-md max-w-max-page p-md md:pl-2xl md:pr-2xl m-auto mt-[6rem] flex flex-col">
  {% if title || description %}
    <div class="gap-base flex flex-col">
      {% if title %}
        <h3 class="font-bold">{{ title }}</h3>
      {% endif %}

      {% if description %}
        <h6 class="text-nickel">{{ description }}</h6>
      {% endif %}
    </div>
  {% endif %}

  <div class="gap-md flex flex-col xl:flex-row">
    <tosoh-cct-filters></tosoh-cct-filters>
    <div class="border-border flex w-full flex-col rounded-2xl border">
      <div class="p-base flex w-full items-center justify-center">
        <h6 class="font-semibold">
          TOSOH : {{ tosoh_instrument_name }}
          <span class="text-imperial-red font-semibold">versus</span>
          {{ competitor_instrument.company.label }} : {{ competitor_instrument.product_name }}
        </h6>
      </div>
      <div class="w-full max-w-[calc(100vw-(var(--spacing-md)*2))] h-full">
        <tosoh-scroll-x>
          <div>
            <div class="mx-auto flex w-full min-w-[56rem] lg:min-w-0">
              {% for role in roles %}
                <tosoh-tab-group
                  {{ loop.last ? 'isLast="true"' : '' }}
                  variant="action"
                  groupId="{{ role[1] }}"
                  {{ loop.first ? 'active="true"' : '' }}>
                  {{ role[0] }}
                </tosoh-tab-group>
              {% endfor %}
            </div>
          </div>
          <div class="divide-border flex h-full w-full min-w-[56rem] justify-center divide-x lg:min-w-0">
            <div class="p-md flex w-full h-full flex-col">
              <h6 class="mb-sm text-center font-semibold">TOSOH Benefits Sum-Up</h6>
              {% for role in roles %}
                <tosoh-tab-group variant="tab" groupId="{{ role[1] }}" {{ loop.first ? 'active="true"' : '' }}>
                  <div>{{ tosoh_instrument[role[1]] }}</div>
                </tosoh-tab-group>
              {% endfor %}
            </div>

            <div class="p-md flex w-full h-full flex-col">
              <h6 class="mb-sm text-center font-semibold">Benefits Sum-Up</h6>
              {% for role in roles %}
                <tosoh-tab-group variant="tab" groupId="{{ role[1] }}" {{ loop.first ? 'active="true"' : '' }}>
                  <div>{{ competitor_instrument[role[1]] }}</div>
                </tosoh-tab-group>
              {% endfor %}
            </div>
          </div>
        </tosoh-scroll-x>
      </div>
    </div>
  </div>
</div>
